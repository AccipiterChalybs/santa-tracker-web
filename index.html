<!--
Copyright 2015 Google Inc. All rights reserved.

Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at

      http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed
under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
CONDITIONS OF ANY KIND, either express or implied. See the License for the
specific language governing permissions and limitations under the License.
-->
<!DOCTYPE html>
<html lang="en" itemscope="itemscope" itemtype="http://schema.org/WebPage">
<head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <title msgid="meta_title">Google Santa Tracker</title>
  <meta property="og:title" itemprop="name" msgid="meta_title" content="Google Santa Tracker">
  <meta property="og:type" content="website">
  <meta property="og:image" itemprop="image" name="thumbnail" content="https://santatracker.google.com/images/og.png">
  <meta property="og:image:width" content="1333">
  <meta property="og:image:height" content="1000">
  <meta property="og:description" itemprop="description" name="description" msgid="meta_description" content="Use Google Santa Tracker to follow Santa Claus on Google Maps as he makes his journey around the world.">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@googlemaps">
  <meta name="twitter:title" msgid="meta_title" content="Google Santa Tracker">
  <meta name="twitter:description" msgid="meta_description" content="Use Google Santa Tracker to follow Santa Claus on Google Maps as he makes his journey around the world.">
  <meta name="twitter:image" content="https://santatracker.google.com/images/og.png">

  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:100,300,400,500,600,700,800|Lobster">
  <link rel="stylesheet" href="sass/santatracker.css">

  <meta name="theme-color" content="#00c6ed">

  <!-- non-standard meta tags -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="#00c6ed">
  <meta name="msapplication-TileColor" content="#30B443">
  <meta name="msapplication-tap-highlight" content="no">

  <!-- icons -->
  <link rel="apple-touch-icon" sizes="76x76" href="/images/icon-76.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/icon-120.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/icon-152.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/images/icon-167.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/icon-180.png">
  <link id="favicon" rel="shortcut icon" href="/images/favicon-16.png" sizes="16x16">
  <link id="favicon" rel="shortcut icon" href="/images/favicon-32.png" sizes="32x32">
  <link id="favicon" rel="shortcut icon" href="/images/favicon-64.png" sizes="64x64">
  <link id="favicon" rel="shortcut icon" href="/images/favicon-96.png" sizes="96x96">

  <!-- Analytics -->
  <script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-37048309-' + (location.hostname == 'santatracker.google.com' ? 1 : 2), 'auto');
ga('set', 'transport', 'beacon');
  </script>
  <script async src="https://www.google-analytics.com/analytics.js"></script>

  <!-- JS -->
  <link id="DEV" comment="element removed in prod" />
  <link id="ES5_ADAPTER" comment="replaced with es5 adapter in prod">
  <script>
(function() {
  // Santa Tracker supports Chrome, Firefox, and Edge; it also supports IE11, Safari 9+ and
  // Chromium-based browsers at m44 or above. For other browsers, YMMV.
  var ignoreCheck =
      window.location.search.indexOf('ignore_browser_check') !== -1 ||
      navigator.userAgent.indexOf('Googlebot') !== -1;
  var supported = ignoreCheck || (function() {
    // feature-detect APIs: limits to IE11+, SF9+
    if (!window.performance || !window.performance.now || !window.WeakMap || !window.history) {
      return false;
    }
    // no older Android browser
    var uaString = navigator.userAgent;
    if (uaString.indexOf('Chrome') === -1 && uaString.indexOf('Android') !== -1) {
      return !/^Google/.test(navigator.vendor);
    }
    // no older Chromium (e.g., Samsung browser fork or ancient install)
    var chromeVersion = /Chrome\/(\d+)/.exec(uaString);
    if (chromeVersion && chromeVersion[1]) {
      return parseInt(chromeVersion[1], 10) >= 44;
    }
    return true;
  })();

  if (!supported) {
    // fail over to upgrade.html, falling back to timeout in case Analytics is failing.
    function redirect() {
      window.location = 'upgrade.html' + (window.location.query || '');
    }
    window.ga('send', 'pageview', '/');
    window.ga('send', 'event', 'Polymer', 'unsupported-browser', {hitCallback: redirect});
    window.setTimeout(redirect, 1000);
  }

  // Track and log any errors to analytics. Don't allow further exceptions.
  window.onerror = function(msg, file, line, col, error) {
    window.ga('send', 'event', {
      eventCategory: 'Script',
      eventAction: 'uncaught error',
      eventLabel: error ? error.stack : msg + '\n' + file + ' ' + line + ':' + col,
    });
  };

  // Look in /intl/.../ and ?hl=... for user override lang. Send the browser to the correct /intl/
  // version via History API. e.g., a user loading "/#foo?hl=de" will get "/intl/de/#foo".
  var url = (function() {
    // Look for /intl/../ (look for _last_). This wins over ?hl=...
    var match = window.location.pathname.match(/.*\/intl\/([^_/]+)(?:|_ALL)\//);
    var lang = match && match[1];

    // Otherwise, look for ?hl=..., and remove it from the URL regardless.
    var search = window.location.search || '';
    var matchLang = /(?:\?|&)hl=([^&]*)\b/;
    if (!lang) {
      match = matchLang.exec(search);
      lang = match && match[1];
    }
    search = search.replace(matchLang, '').replace(/^&/, '?');

    // Save requestLang on window. This is a bit ugly, but lets us persist this param.
    window.requestLang = lang;

    // Grab the final URL component. This is 'us', the fanned out HTML file.
    match = window.location.pathname.match(/(\/(?:\w+\.html|))$/)
    var path = match ? match[1] : '/';

    // Generate canonical URL.
    var url = window.location.origin;
    if (lang) {
      var prod = window.location.hostname === 'santatracker.google.com';
      url += '/intl/' + lang + (prod ? '' : '_ALL');
    }
    return url + path + search + window.location.hash;
  })();
  history.replaceState(null, document.title, url);

  // Append/create the manifest URL.
  var manifest = document.createElement('link');
  manifest.rel = 'manifest';
  manifest.crossOrigin = 'use-credentials';
  manifest.href = 'manifest.json';  // avoid href rewriting from gulpfile
  document.head.appendChild(manifest);
  if ('serviceWorker' in navigator) {
    // Register the SW in the served language, not the request language (as this isn't available
    // on the naked domain anyway).
    var prod = window.location.hostname === 'santatracker.google.com';
    if (prod) {
      window.sw = navigator.serviceWorker.register('/sw.js?lang=' + document.documentElement.lang);
    } else {
      navigator.serviceWorker.register('/sw-dummy.js');
    }

    // Reload the page when a new SW takes over. This should only happen in staging.
    navigator.serviceWorker.addEventListener('controllerchange', function() {
      window.location.reload();
    });
  }

  window.Polymer = {
    noUrlSettings: true,
    dom: 'shadow',
    lazyRegister: 'max',
    useNativeCSSProperties: true,
  };
}());
  </script>
  <link rel="import" href="elements/elements_en.html" crossorigin>
</head>
<body data-version="" data-static="" unresolved class="scrollock">

<script>
  // nb. this can't be configured via window.Polymer and seemingly must be done before elements
  // are stamped (https://github.com/Polymer/polymer/issues/4847)
  // TODO(samthor): include on other entrypoints
  Polymer.setPassiveTouchGestures && Polymer.setPassiveTouchGestures(true);
</script>

<santa-app id="santaApp" routing></santa-app>

<santa-countdown role="timer" aria-live="assertive" aria-atomic="false" aria-relevant="additions" hidden></santa-countdown>

<santa-notice></santa-notice>

<div id="unresolved_placeholder"></div>

<script>
(function() {

function lazyLoadWCPolyfillsIfNecessary() {
  var requiredPolyfillCount = 0;
  var loadedPolyfillCount = 0;

  var onload = function() {
    if (++loadedPolyfillCount < requiredPolyfillCount) {
      return;
    }

    // If the browser supports native HTML Imports, manually fire the WCR event
    // so the same code paths can be used for polyfill'd and native.
    // window.HTMLImports only exists under the poylfill.
    if (!window.HTMLImports) {
      document.dispatchEvent(new CustomEvent('WebComponentsReady', {bubbles: true}));
    }
  };

  var loadPolyfill = (function() {
    var baseUrl = document.body.getAttribute('data-static');
    return function(url, defer) {
      requiredPolyfillCount++;
      var script = document.createElement('script');

      if (defer) {
        script.async = false;
      }

      script.src = baseUrl + url;
      script.onload = onload;
      document.head.appendChild(script);
    };
  })();

  // @see https://github.com/webcomponents/URL/blob/master/url.js#L8-L15
  var hasWorkingUrl = false;
  try {
    var u = new URL('b', 'http://a');
    u.pathname = 'c%20d';
    hasWorkingUrl = u.href === 'http://a/c%20d';
  } catch (e) {}

  if (!hasWorkingUrl) {
    loadPolyfill('components/url/url.js');
  }

  var webComponentsSupported =
      'registerElement' in document
      && 'import' in document.createElement('link')
      && 'content' in document.createElement('template');

  if (!webComponentsSupported) {
    loadPolyfill('components/webcomponentsjs/webcomponents-lite.js', true);
  }

  if (requiredPolyfillCount === 0) {
    onload();
  }
}

// log some polymer startup performance numbers
function setupPerfAnalyticsEvent(eventName, categoryName) {
  document.addEventListener(eventName, function() {
    var now = window.performance.now();
    ga('send', 'timing', categoryName, eventName, Math.round(now));
  });
}

setupPerfAnalyticsEvent('HTMLImportsLoaded', 'Polymer');
setupPerfAnalyticsEvent('WebComponentsReady', 'Polymer');

lazyLoadWCPolyfillsIfNecessary(); // Call after all events have been set up.

if (window.santaApp.mode === 'portal') {
  // Filter out clicks that don't match the current domain.
  document.body.addEventListener('click', function(event) {
    var link = event.composedPath().filter(function(el) {
      return el.localName === 'a' && el.href;
    })[0];
    if (link && link.href.indexOf(window.location.origin + '/') !== 0) {
      event.stopPropagation();
      event.preventDefault();
    }
  });

  // third_party libraries for portal input.
  var baseUrl = document.body.getAttribute('data-static');
  var libs =
      ['eventemitter2/eventemitter2.min.js', 'roslibjs/roslib.min.js', 'spacenav/spacenav.js'];
  libs.forEach(function(lib) {
    var s = document.createElement('script');
    s.src = baseUrl + 'third_party/lib/' + lib;
    document.body.appendChild(s);
  });
}

window.setTimeout(function() {
  var urlStyle = 'font-size: 16px; line-height: 24px; background: #555; color: white; padding: 4px; border-radius: 4px;';
  var textStyle = function(color) { return 'font-size: 16px; line-height: 24px; color: ' + color + ';' }
  console.info('%cHi there! Are you interested in learning about how the helper elves build Santa Tracker? 🎅🎄🎁 %cWatch us 👩‍💻👨‍💻 on the Chrome Developers Channel:', textStyle('blue'), textStyle('red'));
  console.info('%chttps://youtube.com/playlist?list=PLNYkxOF6rcIAQ-xb-Y04twWvKJU6N2UVm', urlStyle);
  console.info('%cOr find the source code on GitHub:', textStyle('green'));
  console.info('%chttps://github.com/google/santa-tracker-web', urlStyle);
}, 1000);

})();
</script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
</head>
<body>
<h1>Time set:</h1>
<input id='time' type="range" min="1545646140000" max="1545735110000" step=10000>
<p id='timedisp'></p>
<h1>Current stop:</h1>
<p id='current'></p>
<h1>Presents delivered:</h1>
<p id=presents></p>
<h1> Stops:</h1>
<ul id='stops'></ul>

<script type="module">
let allstops=[]


// List Element
const ul = document.querySelector('#stops');

// GitHub API URL
const url = 'https://firebasestorage.googleapis.com/v0/b/santa-tracker-firebase.appspot.com/o/route%2Fsanta_en.json?alt=media';

// make the API call
fetch(url)
    .then(res => res.json())
    .then(data => {
      allstops = data.destinations;
      //console.log(allstops)
      // iterate over stops
      data.destinations.map((stop) => {
          // create the elements
          //console.log(stop.arrival, parseInt(time.value), stop.departure);
          let li = document.createElement('li'),
              span = document.createElement('span'),
              span0 = document.createElement('span');
          span.innerText = stop.city;
          span0.innerText = ' Arrival:'+new Date(stop.arrival);
          // append all elements
          li.append( span);
          li.append(span0);
          ul.append( li);
        });
    }).catch(err => {
        console.error('Error: ', err);
    });
function timeset(){
  let timev=parseInt(time.value)
  timedisp.textContent = new Date(timev);
  allstops.map((stop) =>{
    //if(stop.arrival<timev){console.log(stop.city)}
    //if(stop.departure>timev){console.log(stop.city)}
    if(stop.arrival <= timev&& timev < stop.departure){
      current.textContent = stop.city;
      presents.textContent = stop.presentsDelivered;
    }
  })
}
time.oninput = timeset;
</script>

</body>
</html>

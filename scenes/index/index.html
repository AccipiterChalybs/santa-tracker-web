<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:300,400,500,700,900|Lobster" />
  <link rel="stylesheet" href="index.css" />
</head>
<body>

<script type="module">
  import api from '../../src/scene/api.js';
  import '../../src/elements/santa-weather.js';
  import '../../src/elements/santa-image-mask.js';
  import './elements/village-countdown.js';

  const offset = {x: 0, y: 0};
  let previousPointer = null;

  const container = document.getElementById('village-container');
  const scroll = document.getElementById('village-scroll');

  function updateOffset(delta) {
    const scrollSize = scroll.getBoundingClientRect();
    const containerSize = container.getBoundingClientRect();

    if (delta) {
      const factor = 2.2;
      offset.x += delta.x / factor;
      offset.y += delta.y / factor;
    }

    const allowed = {
      x: (scrollSize.width - containerSize.width) >> 1,
      y: (scrollSize.height - containerSize.height) >> 1,
    };
    if (Math.abs(offset.x) > allowed.x) {
      offset.x = Math.sign(offset.x) * allowed.x;
    }
    if (Math.abs(offset.y) > allowed.y) {
      offset.y = Math.sign(offset.y) * allowed.y;
    }

    scroll.style.transform = `translate(-50%, -50%) translate(${~~offset.x}px, ${~~offset.y}px)`;
  }

  function resetPointer() {
    previousPointer = null;
  }

  scroll.addEventListener('pointermove', (ev) => {
    if (ev.buttons !== 1) {
      return;
    }

    const heldPointer = previousPointer;
    previousPointer = {x: ev.screenX, y: ev.screenY};

    if (heldPointer) {
      const delta = {x: ev.screenX - heldPointer.x, y: ev.screenY - heldPointer.y};
      updateOffset(delta);
    }
  });
  ['pointerup', 'pointerout', 'pointerleave'].forEach((eventName) => {
    scroll.addEventListener(eventName, resetPointer);
  });

  window.addEventListener('resize', (ev) => updateOffset());

</script>

<div id="village-container">
  <div id="village-scroll" class="village">
    <santa-weather></santa-weather>
    <div class="sky">
      <village-countdown time="1000000"></village-countdown>
    </div>
    <div class="ground"></div>
    <div class="road"></div>
    <div class="mid">
      <div class="feature-tree"></div>
      <div id="easteregg-blocks" class="easteregg"></div>
      <div id="easteregg-statue" class="easteregg"></div>
      <div id="easteregg-penguin-revolt" class="easteregg"></div>
      <div id="easteregg-snowman-reading" class="easteregg"></div>
      <div id="easteregg-rosetta-stone" class="easteregg"></div>
      <div id="easteregg-book-club" class="easteregg"></div>
      <div id="easteregg-unicycle" class="easteregg"></div>
      <div id="easteregg-walrus" class="easteregg"></div>
      <div id="easteregg-white-board" class="easteregg"></div>
      <div id="easteregg-schoolyard" class="easteregg">
        <div class="slide"></div>
        <div class="seesaw"></div>
        <div class="swing"></div>
      </div>
      <div id="easteregg-balloon" class="easteregg"></div>
      <div id="easteregg-tictactoe" class="easteregg">
          <div class="cell empty"></div>
          <div class="cell empty"></div>
          <div class="cell empty"></div>
          <div class="cell empty"></div>
          <div class="cell empty"></div>
          <div class="cell empty"></div>
          <div class="cell empty"></div>
          <div class="cell empty"></div>
          <div class="cell empty"></div>
          <div id="elves-red" class="elves"></div>
          <div id="elves-blue" class="elves"></div>
          <div id="win"></div>
      </div>
      <a href="#" id="easteregg-snowmobile1" class="easteregg"></a>
      
    </div>
    <div class="foreground"></div>
  </div>
</div>

<div id="quilt-container">
  <div class="quilt">
    <a href="#">
      <santa-image-mask src="../../img/scenes/airport_1x.png" size="200">Airport</santa-image-mask>
    </a>
    <a href="#">
      <santa-image-mask src="../../img/scenes/boatload_1x.png" size="200">Gift Slingshot</santa-image-mask>
    </a>
    <a href="#">
      <santa-image-mask src="../../img/scenes/codeboogie_1x.png" size="200">Code Boogie</santa-image-mask>
    </a>
    <a href="#">
      <santa-image-mask src="../../img/scenes/snowball_1x.png" size="200">Snowball Storm</santa-image-mask>
    </a>
    <a href="#">
      <santa-image-mask src="../../img/scenes/smatch_1x.png" size="200">Gift Match</santa-image-mask>
    </a>
  </div>
</div>

</body>
</html>

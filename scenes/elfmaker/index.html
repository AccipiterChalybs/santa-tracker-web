<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:100,300,400,500,600,700,800|Lobster|Material+Icons" />
  <link rel="stylesheet" href="elfmaker.css" />

  <script src="../../node_modules/@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
</head>
<body>

<main id="main">
  <div class="buttons"></div>
  <div class="mid">
    <maker-elf id="elf"></maker-elf>
  </div>
  <div class="buttons">
    <santa-button id="share" color="green">share</santa-button>
    <santa-button id="camera" color="red">photo_camera</santa-button>
  </div>
</main>

<footer>
  <maker-control category="body" id="control"></maker-control>
</footer>

<maker-photo id="photo"></maker-photo>

<script type="module">

import api from '../../src/scene/api.js';
import './elements/maker-chooser.js';
import './elements/maker-control.js';
import './elements/maker-elf.js';
import './elements/maker-photo.js';
import '../../src/elements/santa-button.js';
import * as defs from './defs.js';

api.preload.sounds('elfmaker_load_sounds', 40);

api.preload.images(
  'img/bg-complex.png',
  'img/bg-simple.png',
  'img/btn_accessories.svg',
  'img/btn_body.svg',
  'img/btn_ears.svg',
  'img/btn_glasses.svg',
  'img/btn_hair.svg',
  'img/btn_hats.svg',
  'img/btn_left.svg',
  'img/btn_redo.svg',
  'img/btn_right.svg',
  'img/btn_share.svg',
);

const dataProperties = [
  'skinTone', 'hairColor', 'suitColor', 'eyesColor', 'earsColor', 'hatsColor', 'accessoriesColor',
];

const control = document.getElementById('control');
control.addEventListener('change', (ev) => {
  api.data({elf: control.serializeState()});

  elf.categoryChoice = control.categoryChoice;
  elf.svgStyle = control.svgStyle;

  const bgUrl = defs.backgrounds[control.categoryChoice['backgrounds']];
  main.style.backgroundImage = `url(${bgUrl})`;
});

share.addEventListener('click', (ev) => {
  elf.draw().then((result) => {
    console.info('got image', result);
    api.gameover({image: result});
  });
  window.santaApp.fire('sound-trigger', 'generic_button_click');
});

camera.addEventListener('click', (ev) => {
  photo.capture(elf.draw());
});

api.ready(async (data) => {
  control.deserializeState(data && data.elf);
  window.santaApp.fire('sound-ambient', 'music_start_scene');
});

</script>

</body>
</html>

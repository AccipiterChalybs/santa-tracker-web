$name: 'module-dorf';

@import "../shared/sass/_mixins.scss";

@import "sass/variables";
@import "sass/animations";

:host {
  background: #f5f2e2;
}

[hidden] {
  display: none !important;
}

// # Common

p {
  margin: 0 auto;
  color: #fff;
  text-align: center;
  font-weight: 500;
  font-size: 20px;
  letter-spacing: -1px;
  line-height: 24px;
  text-shadow: 0 1px 0 rgba(0, 0, 0, 0.25);
}
a {
  color: inherit;
  text-decoration: none;
}
.launchdate {
  font-family: 'Lobster', sans-serif;
  font-size: 2em;
  line-height: 1.4em;
  padding: 0.4em 0 0;
}
h4 {
  display: inline-block;
  padding-top: 0.2em;
  font-family: 'Lobster', sans-serif;
  font-size: 2.875em;
  line-height: 1.5em;
  text-shadow: 0 2px 0 rgba(0, 0, 0, 0.25);
  transform: rotateZ(-3deg);
  width: auto;
  margin: 0;
  white-space: nowrap;
}
h3 {
  font-size: 1em;
  line-height: 1.5em;
  text-shadow: 0 1px 0 rgba(0, 0, 0, 0.5);
  font-weight: 500;
  margin: 0;
}

// # Header

village-header {
  p {
    font-weight: 600;
    max-width: 400px;
  }

  $extra-height: 132px;
  a.button {
    pointer-events: auto;
    margin-top: $extra-height;
    background: #83ce00;
    border-radius: 4px;
    color: #fff;
    font-weight: 600;
    font-family: 'Lobster';
    font-size: 23px;
    line-height: 32px;
    padding: 0 16px;
    border: 2px solid transparent;
    position: relative;
    box-shadow: 0 3px 0 #659e00;
    will-change: transform;
    text-shadow: 0 1px 0 rgba(0, 0, 0, 0.125);
    cursor: pointer;
    text-decoration: none;
    z-index: 10;  // nb. we need this to be clickable on mobile

    &:active {
      box-shadow: 0 1px 0 #659e00;
      transform: translateY(2px);
    }

    &:focus {
      border-color: rgba(255, 255, 255, 0.25);
      outline: none;
    }

    &::before {
      content: '';
      position: absolute;
      top: -($extra-height);
      width: 200px;
      left: 50%;
      transform: translateX(-50%);
      bottom: 0;
      background: url(img/santa-takeoff.svg) center top no-repeat;
      background-size: 128px 128px;
      display: block;
    }
  }

  &:not(.track) {
    a.button {
      display: none;
    }
  }
  &.notext {
    p {
      display: none;
    }
  }
  @media (max-width: ($width-tablet - 1)) {
    p {
      display: none;
    }
  }

  // header effects
  santa-weather {
    width: 100%;
    height: 100%;
  }

  #effect-sun {
    position: absolute;
    top: 32px;
    left: 70%;
    width: 107px;
    height: 109px;
    background: url(img/sun.svg) no-repeat;
  }

  #effect-plane {
    will-change: transform;
    position: absolute;
    top: 32px;
    width: 171px;
    height: 82px;
    margin-left: -(171px/2);
    background: url(img/plane.svg) center no-repeat;
    // this only animates across the screen for <10% of the time
    animation: #{$name}-plane 75s infinite linear;
  }

  effect-skydive {
    // nb. this isn't clickable on mobile; it's probably fine
    position: absolute;
    left: calc(50% + 520px);
    top: 433px;
    @media (max-width: ($width-desktop - 1)) {
      transform: scale(0.6);
      left: calc(50% + 300px);
    }
    @media (max-width: ($width-tablet - 1)) {
      left: 50%;
      top: 264px;
    }
  }
}

// # Footer

footer {
  z-index: $base-background-z-index;
  position: relative;
  background: url(img/footer-snow-tile.svg) repeat-x;
  background-size: contain;
  background-position: center bottom;
  min-height: 200px;

  @media (min-width: $width-tablet) {
    margin-top: -200px;
  }

  p {
    padding: 20px 12px;
    color: #3474ba;
    font-size: 22px;
    line-height: 26px;
    max-width: 400px;
    text-shadow: none;
  }

  img {
    width: 100%;
    max-width: $width-desktop + 240px;
    margin: 20px auto 0;
    display: block;
  }

  &.countdown-finished {
    img {
      // finished image is much taller; keep to max size
      width: 800px;
      max-width: 100%;
    }
  }
}

// # Mobile Text

#mobiletext {
  display: none;
}
@media (max-width: ($width-tablet - 1)) {
  #mobiletext {
    pointer-events: none;
    box-shadow: 0 2px 0 rgba(0, 0, 0, 0.125);
    z-index: 100;
    display: block;
    background: #00c6ed;
    color: white;
    padding: 17px 24px 16px;
    border-bottom: 2px solid rgba(0, 0, 0, 0.125);
    position: relative;

    &::before, &::after {
      content: '';
      position: absolute;
      top: -100px;
      height: 120px;
      display: block;
      background: transparent bottom center no-repeat;
    }

    &::before {
      left: 0;
      width: 140px;
      background-image: url(img/mobile-elf1.svg);
    }

    &::after {
      right: 0;
      width: 128px;
      background-image: url(img/mobile-elf2.svg);
    }
  }
}

// # Houses

@import "sass/houses";

#village-all {
  pointer-events: none;
  z-index: $base-background-z-index;
  overflow: hidden;
  position: relative;  // nb. creates a z-index layer for children
  pointer-events: none;

  #houses {
    display: flex;
    align-content: flex-start;
    flex-flow: wrap;
  }

  @media (min-width: $width-tablet) {
    font-size: 16px;
    pointer-events: none;
    padding-bottom: 300px;

    // Move the village up by 30px, but give the layer an extra 30px to work
    // with: this gives space for the hover cards.
    margin-top: 0 - $village-offset-up - $village-extra-padding;
    border-top: $village-extra-padding solid transparent;

    @import "sass/eastereggs";

    #houses {
      margin: 0 auto;
      width: $width-desktop;
      height: $height-desktop;
      z-index: 10;
      pointer-events: auto;
    }

    #background {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: $ground-size-h + $ground-top;
      background-image: url(img/ground.svg);
      background-repeat: repeat-x;
      background-size: $ground-size-w $ground-size-h;
      background-position: 50% $ground-top;

      &::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: $road-size-h + $road-top;

        background-image: url(img/road.svg);
        background-repeat: no-repeat;
        background-size: $road-size-w $road-size-h;
        background-position: 50% $road-top;
      }
    }
  }

  @media (max-width: ($width-desktop - 1)) and (min-width: $width-tablet) {
    font-size: 12px;
    margin-top: (0 - $village-offset-up - $village-extra-padding) * $tablet-desktop-ratio;
    border-top-width: $village-extra-padding * $tablet-desktop-ratio;

    #houses {
      width: $width-tablet;
      height: $height-tablet;
    }

    #background {
      height: ($ground-size-h + $ground-top) * $tablet-desktop-ratio;
      background-size:
          ($ground-size-w * $tablet-desktop-ratio) ($ground-size-h * $tablet-desktop-ratio);
      background-position-y: $ground-top * $tablet-desktop-ratio;

      &::after {
        height: ($road-size-h + $road-top) * $tablet-desktop-ratio;
        background-size:
            ($road-size-w * $tablet-desktop-ratio) ($road-size-h * $tablet-desktop-ratio);
        background-position-y: $road-top * $tablet-desktop-ratio;
      }
    }
  }

  @media (max-width: $width-tablet - 1) {
    font-size: 14px;
  }
}

// # Card

.card {
  text-align: center;
  position: relative;
  height: 100%;
  display: flex;
  flex-flow: column;

  &::before {
    content: '';
    z-index: -2;
    position: absolute;
    display: block;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: transparent center no-repeat;
    background-size: cover;
    // nb. using a var(--...) here causes Chrome to redraw every frame because _maybe_ it changed
    // look in _houses.scss for the background-image: ...
  }

  &::after {
    content: '';
    z-index: -1;
    position: absolute;
    background: var(--scene-color, #00c6ed);
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    opacity: 0.75;
  }
}

// # Links

#links {
  display: flex;
  align-content: flex-start;
  flex-flow: wrap;

  @media (min-width: $width-tablet) {
    font-size: 12px;
    position: absolute;
    z-index: 10000;

    width: $width-tablet;
    left: 0;
    right: 0;
    margin: 0 auto;
  }
  @media (min-width: $width-desktop) {
    font-size: 16px;
    width: $width-desktop;
  }
}

.link {
  position: relative;
  color: #fff;

  @media (max-width: $width-tablet - 1px) {
    width: 50%;
    min-height: 204px;
    flex-grow: 1;

    h4 {
      display: none;
    }
    h3 {
      letter-spacing: 1px;
      font-size: 1em;
      line-height: 1em;
      margin-top: 2px;
      text-transform: uppercase;
      text-shadow: none;
    }

    &:not([href]) {
      .launchdate::after {
        content: '';
        width: 42px;
        height: 42px;
        margin: 0 auto;
        background: url(img/lock.svg) no-repeat center;
        background-size: contain;
        display: block;
      }
    }

    .card {
      z-index: 0;
    }

    &[href] {
      // order in reverse order, if released
      order: var(--release-order, 0);

      .card {
        &::after {
          z-index: -3;  // move below bg, as an indicative color during card load
          opacity: 1;
        }
      }
    }
    &:not([href]) {
      .card {
        justify-content: center;
      }
      h3 { 
        display: none;
      }
      .launchdate {
        padding-top: 0;
        font-size: 5em;
      }
    }
  }
  @media (max-width: 600px) {
    width: 100%;
  }
  @media (min-width: $width-tablet) {
    $duration-in: 0.23s;
    $easing-in: cubic-bezier(0,1,.33,1.28);
    $duration-out: 0.2s;
    $easing-out: cubic-bezier(.83,.02,1,.01);

    width: $dim-house * $tablet-desktop-ratio;
    height: $dim-house * $tablet-desktop-ratio;

    .launchdate {
      display: none;
    }

    // .link isn't visible, but this makes it selectable
    border-radius: 10000px;
    display: block;
    pointer-events: auto;

    .card {
      position: absolute;
      top: 50%;
      left: 50%;
      border-radius: 10000px;
      transition: transform $duration-out $easing-out, opacity $duration-out $easing-out;
      transform: scale(0);
      will-change: transform;
      box-shadow: 4px 14px 0 rgba(0, 0, 0, .125);

      $dim: 172px;
      margin-left: -($dim / 2);
      margin-top: -($dim / 2);
      width: $dim;
      height: $dim;

      &::before {
        border-radius: 10000px;
        will-change: transform;
        transform: rotate(10deg) translateZ(0);
        transition: transform 0.01s ease-out $duration-out;
      }
      &::after {
        display: none;
      }

    }

    &[href]:hover {
      .card {
        transition: transform $duration-in $easing-in, opacity $duration-in $easing-in;
        transform: scale(1);

        &::before {
          transform: rotate(0deg) translateZ(0);
          transition: transform $duration-in ease-out 0.02s;
        }
      }
    }
  }
  @media (min-width: $width-desktop) {
    width: $dim-house;
    height: $dim-house;

    .card {
      $dim: 282px;
      margin-left: -($dim / 2);
      margin-top: -($dim / 2);
      width: $dim;
      height: $dim;
    }
  }
}

// # Cells

.cells {
  display: flex;
  align-content: flex-start;
  flex-flow: wrap;

  @media (min-width: $width-tablet) {
    $dim: 192px;
    width: $dim * 4;
    margin: 0 auto;

    .cell {
      position: relative;
      box-sizing: border-box;
      width: $dim;
      height: $dim;
      --house-ratio: 0.6;

      village-house {
        position: absolute;
        left: calc(var(--cell-x) * 100%);
        top: calc(var(--cell-y) * 100%);
        z-index: var(--cell-layer);
      }
    }
  }
  @media (min-width: $width-desktop) {
    $dim: 320px;
    width: $dim * 4;

    .cell {
      width: $dim;
      height: $dim;
      --house-ratio: 1;
    }
  }
}

// # New Today

#house-new-today {
  left: 16px;
  width: 144px;
  height: 144px;
  position: relative;
  text-align: center;

  @media (min-width: $width-desktop) {
    width: 240px;
    height: 240px;
  }

  a {
    z-index: $house-z-index-front;

    &:hover {
      .new-today {
        transform: translateY(-16px);
        transition: transform 0.2s;
      }
    }
  }

  .new-today {
    pointer-events: none;
    background: transparent center no-repeat;
    background-size: contain;
    height: 100%;
    padding-right: 5%;  // overcome shadow
    transform: translateY(0);
    transition: transform 0.5s cubic-bezier(0.47, 2.02, 0.31, -0.36);
    will-change: transform;
    display: flex;
    flex-flow: column;
    align-items: center;

    &::before {
      content: '';
      
    }

    h4 {
      padding: 0;
      font-size: 2em;
      transform: none;
    }
  }
}
